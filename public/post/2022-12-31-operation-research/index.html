<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Operation research | Küse&#39;s Codes</title>
<meta name="keywords" content="OR, OR-Tools">
<meta name="description" content="Operation Research is defined in Wikipedia as
Operations research (British English: operational research) &hellip; , often shortened to the initialism OR, is a discipline that deals with the development and application of analytical methods to improve decision-making.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/post/2022-12-31-operation-research/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/post/2022-12-31-operation-research/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>






</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Küse&#39;s Codes (Alt + H)">Küse&#39;s Codes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/post" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/draft" title="Drafts">
                    <span>Drafts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about" title="About me">
                    <span>About me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/post/">Küse&#39;s Code</a></div>
    <h1 class="post-title">
      Operation research
    </h1>
    <div class="post-meta"><span title='2022-12-31 00:00:00 +0000 UTC'>December 31, 2022</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#linear-optimization-example" aria-label="Linear optimization example">Linear optimization example</a></li>
                <li>
                    <a href="#google-or-tools" aria-label="Google OR-Tools">Google OR-Tools</a><ul>
                        
                <li>
                    <a href="#or-tools-and-dotnet" aria-label="OR-Tools and Dotnet">OR-Tools and Dotnet</a><ul>
                        
                <li>
                    <a href="#c" aria-label="C#">C#</a></li>
                <li>
                    <a href="#f" aria-label="F#">F#</a></li></ul>
                </li>
                <li>
                    <a href="#longer-example" aria-label="Longer example">Longer example</a></li></ul>
                </li>
                <li>
                    <a href="#toy-company" aria-label="Toy Company">Toy Company</a></li>
                <li>
                    <a href="#map-coloring-problem" aria-label="Map coloring problem">Map coloring problem</a></li>
                <li>
                    <a href="#stigler-diet" aria-label="Stigler Diet">Stigler Diet</a><ul>
                        
                <li>
                    <a href="#getting-the-data" aria-label="Getting the data">Getting the data</a></li>
                <li>
                    <a href="#optimization" aria-label="Optimization">Optimization</a></li></ul>
                </li>
                <li>
                    <a href="#julia" aria-label="Julia">Julia</a></li>
                <li>
                    <a href="#flips" aria-label="Flips">Flips</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a></li>
                <li>
                    <a href="#notes" aria-label="Notes">Notes</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Operation Research is defined in <a href="https://en.wikipedia.org/wiki/Operations_research">Wikipedia</a> as</p>
<blockquote>
<p>Operations research (British English: operational research) &hellip; , often shortened to the initialism OR, is a discipline that deals with the development and application of analytical methods to improve decision-making. It is considered to be a subfield of mathematical sciences.</p>
</blockquote>
<p>Typical problems of OR are:</p>
<ul>
<li>production or assembly optimization</li>
<li>routing optimization</li>
<li>scheduling</li>
<li>optimal packaging</li>
</ul>
<p>I have found two good online lecture notes: <a href="https://www.cs.toronto.edu/~stacho/public/IEOR4004-notes1.pdf">Introduction to Operation Research by Juraj Stacho</a> and <a href="https://roughan.info/notes/oorii/03lecture_notes.html">Operation and Operations Resarch by Matthew Roughan</a>.</p>
<p>In this post, I want to show some examples of OR problems and how they can be solved using either <a href="https://developers.google.com/optimization">OR-Tools</a> and dotnet or xx and Julia.</p>
<h2 id="linear-optimization-example">Linear optimization example<a hidden class="anchor" aria-hidden="true" href="#linear-optimization-example">#</a></h2>
<p>All OR problems consist of three components:</p>
<ul>
<li><strong>decision variables</strong>: they define the values that have to be decided upon</li>
<li><strong>goal</strong> or <strong>objective</strong>: the quanitity that needs to be minimized or maximized</li>
<li><strong>objective function</strong>: expression how to compute the goal</li>
<li><strong>constraints</strong>: equalities or inequalities describing restrictions.</li>
</ul>
<p>Our example is taken from <a href="https://developers.google.com/optimization">OR-Tools</a>:</p>
<p>$$
\begin{align}
obj: \text{maximize } 3x + y \text{ subject to:} \cr
c_0: x + y &amp; \le 2 \cr
d_0: 0 \le x &amp; \le 1 \cr
d_1: 0 \le y &amp; \le 2 \cr
\end{align}
$$</p>
<figcaption>Equation 1</figcaption>
<p>In this case, there are two <strong>variables</strong>  <em>x</em> and <em>y</em>, both with defined lower and upper boundaries given in $ d_0 $ and $ d_1 $.</p>
<p>There is one contraint $ c_0 $, with coefficients <em>1.0</em> for <em>x</em> and <em>1.0</em> for <em>y</em>.</p>
<p>The objective function <em>obj</em> has two variables <em>x</em> and <em>y</em>, with coefficients <em>3.0</em> and <em>1.0</em>.</p>
<h2 id="google-or-tools">Google OR-Tools<a hidden class="anchor" aria-hidden="true" href="#google-or-tools">#</a></h2>
<p><a href="https://developers.google.com/optimization">OR-Tools</a> &ldquo;is open source software for combinatorial optimization, which seeks to find the best solution to a problem out of a very large set of possible solutions.&rdquo; Installation is very easy using dotnet, see <a href="https://developers.google.com/optimization/install">OR-Tools installation</a>. Using dotnet it is as easy as: <code>dotnet add package Google.OrTools</code>.</p>
<p><a href="https://developers.google.com/optimization">OR-Tools</a> can be used for many kinds of OR problems. One category is to find any feasible solution (see example xy below), another category is to find an optimal solution, typically trying to minimize or maximize some cost or values.</p>
<p><em>Linear optimization</em> or <em>linear programming (LP)</em> lare supported with two algorithms, one from Google (called <strong>GLOP</strong>) and one for integer only variables and constraints, called <strong>SCIP</strong>. See <a href="https://developers.google.com/optimization/lp">here</a> for more information.</p>
<h3 id="or-tools-and-dotnet">OR-Tools and Dotnet<a hidden class="anchor" aria-hidden="true" href="#or-tools-and-dotnet">#</a></h3>
<p><a href="https://developers.google.com/optimization">OR-Tools</a> have support for C++, Python, Java, and C#. <a href="https://fsharp.org">F#</a> is not supported out of the box. There used to be a wrapper <code>Google.OrTools.FSharp</code> which is still available on <a href="https://www.nuget.org/packages/Google.OrTools.FSharp/#dependencies-body-tab">nuget</a>, but the documentation is no longer available.</p>
<p>Particularly for expressing equations directly in the code, C# is much handier with its implicit type conversion.</p>
<p>Compare these two pieces of code to demonstrate this, taken from <a href="https://developers.google.com/optimization/mip/mip_example">OR-Tools MIP Example</a>:</p>
<p><strong>Maximize $x + 10y$ subject to:</strong></p>
<p>$$
\begin{align}
x &amp;+ 7y &amp; \le 17.5 \cr
x &amp; &amp; \le 3.5 \cr
&amp;x &amp;\ge 0 \cr
&amp;y &amp;\ge 0
\end{align}
$$</p>
<figcaption>Equation 2</figcaption>
<h4 id="c">C#<a hidden class="anchor" aria-hidden="true" href="#c">#</a></h4>
<p><a href="https://developers.google.com/optimization">OR-Tools</a> uses C# as the targeted dotnet programming language. C# with its automatic type conversion lends itself nicely to express algebraic equations.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Google.OrTools;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> solver = LinearSolver.Solver.CreateSolver(<span style="color:#e6db74">&#34;SCIP&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> x = solver.MakeIntVar(<span style="color:#ae81ff">0.0</span>, <span style="color:#66d9ef">double</span>.PositiveInfinity, <span style="color:#e6db74">&#34;x&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> y = solver.MakeIntVar(<span style="color:#ae81ff">0.0</span>, <span style="color:#66d9ef">double</span>.PositiveInfinity, <span style="color:#e6db74">&#34;y&#34;</span>);
</span></span><span style="display:flex;"><span>solver.Add(x + <span style="color:#ae81ff">7</span>*y &lt;= <span style="color:#ae81ff">17.5</span>);
</span></span><span style="display:flex;"><span>solver.Add(x &lt;= <span style="color:#ae81ff">3.5</span>);
</span></span><span style="display:flex;"><span>solver.Maximize(x + <span style="color:#ae81ff">10</span> * y);
</span></span><span style="display:flex;"><span>solver.Solve();
</span></span></code></pre></div><h4 id="f">F#<a hidden class="anchor" aria-hidden="true" href="#f">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#75715e">#r</span> <span style="color:#e6db74">&#34;nuget: Google.OrTools&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Google.OrTools
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> LinearSolver.Solver.CreateSolver<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SCIP&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> Double.PositiveInfinity<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> y <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> Double.PositiveInfinity<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;y&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> c1 <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 17<span style="color:#f92672">.</span>5<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;c1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>c1<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>c1<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>y<span style="color:#f92672">,</span> 7<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> c2 <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> Double.PositiveInfinity<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;c2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>c2<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>Maximize<span style="color:#f92672">(</span>x <span style="color:#f92672">+</span> 10<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>Solve()
</span></span></code></pre></div><p>There is one way to make <a href="https://fsharp.org">F#</a> look somewhat nicer, as shown on <a href="https://stackoverflow.com/questions/65532910/f-or-tools-sat-solver">StackOverflow</a>. You have to explicitly declare the operators for the <code>LinearExpr</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> LinearExprOperators <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#f92672">(</span> <span style="color:#f92672">^&lt;&gt;</span> <span style="color:#f92672">)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>y<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> LinearExpr.<span style="color:#f92672">(&lt;&gt;)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#f92672">(</span> <span style="color:#f92672">^=</span> <span style="color:#f92672">)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>y<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> LinearExpr.<span style="color:#f92672">(=)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#f92672">(^&lt;=)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>y<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> LinearExpr.<span style="color:#f92672">(&lt;=)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#f92672">(^&lt;==)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">:</span> LinearExpr<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>y<span style="color:#f92672">:</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> LinearExpr.<span style="color:#f92672">(&lt;=)</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> LinearExprOperators
</span></span><span style="display:flex;"><span>olver<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>x <span style="color:#f92672">+</span> 7<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> y <span style="color:#f92672">^&lt;==</span> 17<span style="color:#f92672">.</span>5<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>However, this seems to be very cumbersome. In this case, the functional programming style does not lead itself to be more concise.</p>
<h3 id="longer-example">Longer example<a hidden class="anchor" aria-hidden="true" href="#longer-example">#</a></h3>
<p>Back to the equation 1 of above:</p>
<p><strong>maximize $$ 3x + y $$ subject to:</strong></p>
<p>$$
\begin{align}
x + y &amp; \le 2 \cr
0 \le x &amp; \le 1 \cr
0 \le y &amp; \le 2 \cr
\end{align}
$$</p>
<p>In <a href="https://fsharp.org">F#</a>, the variables <em>x</em> and <em>y</em> are defined with the lower and upper bounds of <em>1</em> and <em>2</em> respectively. We are looking for for integer solutions, therefore we will be using the <code>SCIP</code> linear solver.</p>
<p>The objective function <em>obj</em> is defined with the two coefficients for $ 3x $ and $ 1y $.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#75715e">#r</span> <span style="color:#e6db74">&#34;nuget: Google.OrTools&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Google.OrTools.LinearSolver
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> Solver.CreateSolver<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SCIP&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> <span style="color:#f92672">not</span> <span style="color:#f92672">(</span>isNull solver<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// create variables x and y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> y <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 2<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;y&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// create constraint
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> c1 <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 2<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;c1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>c1<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>c1<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>y<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>Maximize<span style="color:#f92672">(</span>3<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> x <span style="color:#f92672">+</span> y<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> res <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>Solve()
</span></span><span style="display:flex;"><span>printfn <span style="color:#e6db74">&#34;%A&#34;</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e">// OPTIMAL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printfn <span style="color:#e6db74">&#34;objective value: %f&#34;</span> <span style="color:#f92672">(</span>solver<span style="color:#f92672">.</span>Objective()<span style="color:#f92672">.</span>Value()<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// objective value: 4.000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printfn <span style="color:#e6db74">&#34;x = %f&#34;</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">.</span>SolutionValue()<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// x = 1.000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printfn <span style="color:#e6db74">&#34;y = %f&#34;</span> <span style="color:#f92672">(</span>y<span style="color:#f92672">.</span>SolutionValue()<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// y = 1.000000
</span></span></span></code></pre></div><p>The objective function could also be implemented using an explicit objective with coefficients:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> objective <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>Objective()
</span></span><span style="display:flex;"><span>objective<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> 3<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>objective<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>y<span style="color:#f92672">,</span> 1<span style="color:#f92672">.</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>objective<span style="color:#f92672">.</span>SetMaximization()
</span></span></code></pre></div><p>### Another Example</p>
<p>Let&rsquo;s take another example with only integers as variables and using arrays, taken also from <a href="https://developers.google.com/optimization/mip/mip_var_array">OR-Tools Arrays</a>. We will also use <a href="https://fsharp.org">F#</a> 2-dimensional arrays here. These are described in <a href="https://learn.microsoft.com/en-gb/dotnet/fsharp/language-reference/arrays">F# arrays</a>.</p>
<p>This is the optimization:</p>
<p>$$
\begin{align}
\text{Maximize } 7x_1 + 8x_2 + 2x_3 + 9x_4 + 6x_5 \text{ subject to} \cr
5x_1	+	7x_2	+	9x_3	+	2x_4	+	1x_5 &amp; \le	250 \cr
18x_1	+	4x_2	-	9x_3	+	10x_4	+	12x_5 &amp; \le 285 \cr
4x_1	+	7x_2	+	3x_3	+	8x_4	+	5x_5 &amp; \le 211 \cr
5x_1	+	13x_2	+	16x_3	+	3x_4	-	7x_5 &amp; \le 315 \cr
x_i \text{ are positive integers}
\end{align}
$$</p>
<p>In the <a href="https://fsharp.org">F#</a> example, whe will represent the equations as a list of list, such that <code>fst</code> represents the coefficients, and <code>snd</code> the boundaries. We also define <code>Inf</code> as an abbreviations. This most easily resembles the layout of the constraints. The coefficients itself will be stored in a 2-dimensional array.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Microsoft.FSharp.Collections
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> Inf <span style="color:#f92672">=</span> Double.PositiveInfinity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> constraints <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>5<span style="color:#f92672">;</span> 7<span style="color:#f92672">;</span> 9<span style="color:#f92672">;</span> 2<span style="color:#f92672">;</span> 1<span style="color:#f92672">],</span> 250
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>18<span style="color:#f92672">;</span> 4<span style="color:#f92672">;</span> 9<span style="color:#f92672">;</span> 10<span style="color:#f92672">;</span> 12<span style="color:#f92672">],</span> 285
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>4<span style="color:#f92672">;</span> 7<span style="color:#f92672">;</span> 3<span style="color:#f92672">;</span> 8<span style="color:#f92672">;</span> 5<span style="color:#f92672">],</span> 211
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>5<span style="color:#f92672">;</span> 13<span style="color:#f92672">;</span> 16<span style="color:#f92672">;</span> 3<span style="color:#f92672">;</span> 7<span style="color:#f92672">],</span> 315
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> coefficients <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    constraints
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> List.map fst
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> array2D
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> bounds <span style="color:#f92672">=</span> constraints <span style="color:#f92672">|&gt;</span> List.map snd
</span></span></code></pre></div><p>The rest ist straight forward. We declare <code>solver</code>, then create as many variables called <code>x{i+1}</code>, for $ x_1 $ through $ x_5 $, as there are coefficients in the first constraint.</p>
<p>Then we create all the constraints, as many as the 2-d array has rows (<code>coefficients.GetLength(0)</code>). For each constraint <em>i</em>, we create all the coefficients <em>j</em>, associated with the variable <em>j</em>. The constraint is given at <code>coefficients.[i,j]</code>.</p>
<p>Finally, we declare the objective maximization function. To check if everything went fine, we can use the function <code>solver.ExportModelAsLpFormat(false)</code>, which gives a nice print-out of the internal data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> LinearSolver.Solver.CreateSolver<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SCIP&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// make variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> vars <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    fst constraints<span style="color:#f92672">.[</span>0<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> List.mapi <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> i <span style="color:#f92672">_</span> <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>        solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> Inf<span style="color:#f92672">,</span> <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;x{i+1}&#34;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// make constraints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> 0<span style="color:#f92672">..</span>coefficients<span style="color:#f92672">.</span>GetLength<span style="color:#f92672">(</span>0<span style="color:#f92672">)-</span>1 <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> con <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> bounds<span style="color:#f92672">.[</span>i<span style="color:#f92672">],</span> <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;c_{i}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#66d9ef">in</span> 0<span style="color:#f92672">..</span>coefficients<span style="color:#f92672">.</span>GetLength<span style="color:#f92672">(</span>1<span style="color:#f92672">)-</span>1 <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        con<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>vars<span style="color:#f92672">.[</span>j<span style="color:#f92672">],</span> coefficients<span style="color:#f92672">.[</span>i<span style="color:#f92672">,</span> j<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>Maximize<span style="color:#f92672">(</span>7<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> vars<span style="color:#f92672">.[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> 8<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> vars<span style="color:#f92672">.[</span>1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> 2<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> vars<span style="color:#f92672">.[</span>2<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> 9<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> vars<span style="color:#f92672">.[</span>3<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> 6<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> vars<span style="color:#f92672">.[</span>4<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>ExportModelAsLpFormat<span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> printfn <span style="color:#e6db74">&#34;%s&#34;</span>
</span></span></code></pre></div><p>This should give a listing as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csh" data-lang="csh"><span style="display:flex;"><span>% dotnet run
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>Generated by MPModelProtoExporter
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>  Name             : 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>  Format           : Free
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>  Constraints      : 4
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>  Variables        : 5
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>    Binary         : 0
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>    Integer        : 5
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\ </span>    Continuous     : 0
</span></span><span style="display:flex;"><span>Maximize
</span></span><span style="display:flex;"><span> Obj: +7 x1 +8 x2 +2 x3 +9 x4 +6 x5 
</span></span><span style="display:flex;"><span>Subject to
</span></span><span style="display:flex;"><span> c_0_rhs: +5 x1 +7 x2 +9 x3 +2 x4 +1 x5  &lt;<span style="color:#f92672">=</span> 250
</span></span><span style="display:flex;"><span> c_0_lhs: +5 x1 +7 x2 +9 x3 +2 x4 +1 x5  &gt;<span style="color:#f92672">=</span> 0
</span></span><span style="display:flex;"><span> c_1_rhs: +18 x1 +4 x2 +9 x3 +10 x4 +12 x5  &lt;<span style="color:#f92672">=</span> 285
</span></span><span style="display:flex;"><span> c_1_lhs: +18 x1 +4 x2 +9 x3 +10 x4 +12 x5  &gt;<span style="color:#f92672">=</span> 0
</span></span><span style="display:flex;"><span> c_2_rhs: +4 x1 +7 x2 +3 x3 +8 x4 +5 x5  &lt;<span style="color:#f92672">=</span> 211
</span></span><span style="display:flex;"><span> c_2_lhs: +4 x1 +7 x2 +3 x3 +8 x4 +5 x5  &gt;<span style="color:#f92672">=</span> 0
</span></span><span style="display:flex;"><span> c_3_rhs: +5 x1 +13 x2 +16 x3 +3 x4 +7 x5  &lt;<span style="color:#f92672">=</span> 315
</span></span><span style="display:flex;"><span> c_3_lhs: +5 x1 +13 x2 +16 x3 +3 x4 +7 x5  &gt;<span style="color:#f92672">=</span> 0
</span></span><span style="display:flex;"><span>Bounds
</span></span><span style="display:flex;"><span> 0 &lt;<span style="color:#f92672">=</span> x1 &lt;<span style="color:#f92672">=</span> inf
</span></span><span style="display:flex;"><span> 0 &lt;<span style="color:#f92672">=</span> x2 &lt;<span style="color:#f92672">=</span> inf
</span></span><span style="display:flex;"><span> 0 &lt;<span style="color:#f92672">=</span> x3 &lt;<span style="color:#f92672">=</span> inf
</span></span><span style="display:flex;"><span> 0 &lt;<span style="color:#f92672">=</span> x4 &lt;<span style="color:#f92672">=</span> inf
</span></span><span style="display:flex;"><span> 0 &lt;<span style="color:#f92672">=</span> x5 &lt;<span style="color:#f92672">=</span> inf
</span></span><span style="display:flex;"><span>Generals
</span></span><span style="display:flex;"><span> x1
</span></span><span style="display:flex;"><span> x2
</span></span><span style="display:flex;"><span> x3
</span></span><span style="display:flex;"><span> x4
</span></span><span style="display:flex;"><span> x5
</span></span><span style="display:flex;"><span>End
</span></span></code></pre></div><p>Now we just need so solve it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">match</span> solver<span style="color:#f92672">.</span>Solve() <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> LinearSolver.Solver.ResultStatus.OPTIMAL <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>        printfn <span style="color:#e6db74">&#34;solution = %f&#34;</span> <span style="color:#f92672">(</span>solver<span style="color:#f92672">.</span>Objective()<span style="color:#f92672">.</span>Value()<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> v <span style="color:#66d9ef">in</span> vars <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>            printfn <span style="color:#e6db74">&#34;%s = %f&#34;</span> <span style="color:#f92672">(</span>v<span style="color:#f92672">.</span>Name()<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>v<span style="color:#f92672">.</span>SolutionValue()<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> x <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>        printfn <span style="color:#e6db74">&#34;no optimal solution, %A&#34;</span> x
</span></span></code></pre></div><p>which gives us:</p>
<pre><code>solution = 259.000000
x1 = 8.000000
x2 = 19.000000
x3 = 0.000000
x4 = 5.000000
x5 = 1.000000
</code></pre>
<h2 id="toy-company">Toy Company<a hidden class="anchor" aria-hidden="true" href="#toy-company">#</a></h2>
<p>Let&rsquo;st start with a simple example out of <a href="https://www.cs.toronto.edu/~stacho/public/IEOR4004-notes1.pdf">Stacho</a> <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</p>
<blockquote>
<p>A toy company makes two types of toys: toy soldiers and trains. Each toy is produced in two stages, first it is constructed in a carpentry shop, and then it is sent to a finishing shop, where it is varnished, vaxed, and polished. To make one toy soldier costs €10 for raw materials and €14 for labor; it takes 1 hour in the carpentry shop, and 2 hours for finishing. To make one train costs €9 for raw materials and €10 for labor; it takes 1 hour in the carpentry shop, and 1 hour for finishing.</p>
<p>There are 80 hours available each week in the carpentry shop, and 100 hours for finishing. Each toy soldier is sold for €27 while each train for €21. Due to decreased demand for toy soldiers, the company plans to make and sell at most 40 toy soldiers; the number of trains is not restriced in any way.</p>
<p>What is the optimum (best) product mix (i.e., what quantities of which products to make) that maximizes the profit (assuming all toys produced will be sold)?</p>
</blockquote>
<p>Our variables are <code>trains</code> and <code>soldiers</code>, both being integers. What is the objective function? We want to maximize the profit, so what are the costs. The manufacturing costs are:</p>
<ul>
<li><strong>toy soldier</strong>: €27 sales price - €10 for raw material + €14 for labor = €3 profit</li>
<li><strong>trains</strong>: €21 sales price - €9 raw material - €10 labor = €2 profit</li>
</ul>
<p>Therefore, our objective function is: $ \text{maximize } 3 * soldiers + 2 * trains $.</p>
<p>What are our constraints?</p>
<ul>
<li><strong>carpentry shop</strong>: $ soldiers * 1h + trains * 1h $, with 80 hours available</li>
<li><strong>finishing shop</strong>: $ soldiers * 2h + trains * 1h $, with 100 hours available</li>
</ul>
<p>Therefore, the set of equations is:</p>
<p>$$
\begin{align}
\text{max } 3 soldiers + 2 trains \text{ subject to:} \cr
soldiers + trains \le 80 \cr
2 soldiers + trains \le 100 \cr
soldiers \le 40 \cr
soldiers, trains \ge 0
\end{align}
$$</p>
<p>In <a href="https://fsharp.org">F#</a>, this could be implemented like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> Solver.CreateSolver<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SCIP&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> constraints <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span> 1<span style="color:#f92672">;</span> 1 <span style="color:#f92672">],</span> 80
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span> 2<span style="color:#f92672">;</span> 1 <span style="color:#f92672">],</span> 100
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span> 1<span style="color:#f92672">;</span> 0 <span style="color:#f92672">],</span> 40
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> vars <span style="color:#f92672">=</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;soldiers&#34;</span><span style="color:#f92672">;</span> <span style="color:#e6db74">&#34;trains&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">|&gt;</span> List.map<span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> v <span style="color:#f92672">-&gt;</span> solver<span style="color:#f92672">.</span>MakeIntVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> 1000<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> v<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> coefficients <span style="color:#f92672">=</span> constraints <span style="color:#f92672">|&gt;</span> List.map fst <span style="color:#f92672">|&gt;</span> array2D
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> bounds <span style="color:#f92672">=</span> constraints <span style="color:#f92672">|&gt;</span> List.map snd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// make constraints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> 0<span style="color:#f92672">..</span>coefficients<span style="color:#f92672">.</span>GetLength<span style="color:#f92672">(</span>0<span style="color:#f92672">)-</span>1 <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> con <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> bounds<span style="color:#f92672">.[</span>i<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#66d9ef">in</span> 0<span style="color:#f92672">..</span>coefficients<span style="color:#f92672">.</span>GetLength<span style="color:#f92672">(</span>1<span style="color:#f92672">)-</span>1 <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        con<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>vars<span style="color:#f92672">.[</span>j<span style="color:#f92672">],</span> coefficients<span style="color:#f92672">.[</span>i<span style="color:#f92672">,</span> j<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>Maximize<span style="color:#f92672">(</span>3<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> soldiers <span style="color:#f92672">+</span> 2<span style="color:#f92672">.</span>0 <span style="color:#f92672">*</span> trains<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>solver<span style="color:#f92672">.</span>ExportModelAsLpFormat<span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> printfn <span style="color:#e6db74">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// solve it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">match</span> solver<span style="color:#f92672">.</span>Solve() <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> OPTIMAL <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    printfn <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;Optimal revenue = ${solver.Objective().Value()}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> v <span style="color:#66d9ef">in</span> vars <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        printfn <span style="color:#f92672">$</span><span style="color:#e6db74">&#34;{v.Name()} = {v.SolutionValue()}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> x <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>    printfn <span style="color:#e6db74">&#34;no solution found, %A&#34;</span> x
</span></span></code></pre></div><p>This will result in:</p>
<pre tabindex="0"><code>Optimal revenue = $180
soldiers = 20
trains = 60
</code></pre><h2 id="map-coloring-problem">Map coloring problem<a hidden class="anchor" aria-hidden="true" href="#map-coloring-problem">#</a></h2>
<p>The map coloring problem is an example taken from the <a href="https://www.minizinc.org/doc-2.5.5/en/modelling.html">MiniZinc</a> tutorial. The states of Australia have to be colored with maximum 3 colors, such that no adjacent states have the same color.</p>
<p><img loading="lazy" src="https://www.minizinc.org/doc-2.5.5/en/images/aust.svg" alt="Australian States"  />
</p>
<p>Now in this case, we don&rsquo;t have an objective function, we just need any feasible solution. We will therefore use the constrained programming solver, not the linear equation solvers. A variable is created for the color of each state. The constraints are such that neighboring states cannot have the same color.</p>
<p>An implementation in <a href="https://fsharp.org">F#</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Google.OrTools.FSharp.Sat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> model <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CpModel()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> nofColors <span style="color:#f92672">=</span> 3L
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> wa <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;wa&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> nt <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;nt&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> sa <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;sa&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> q <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;q&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> nsw <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;nsw&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;v&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> t <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>NewIntVar<span style="color:#f92672">(</span>1L<span style="color:#f92672">,</span> nofColors<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;t&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// constraints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>wa <span style="color:#f92672">^&lt;&gt;</span> nt<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>wa <span style="color:#f92672">^&lt;&gt;</span> sa<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>nt <span style="color:#f92672">^&lt;&gt;</span> sa<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>nt <span style="color:#f92672">^&lt;&gt;</span> q<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>sa <span style="color:#f92672">^&lt;&gt;</span> q<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>sa <span style="color:#f92672">^&lt;&gt;</span> nsw<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>sa <span style="color:#f92672">^&lt;&gt;</span> v<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>q <span style="color:#f92672">^&lt;&gt;</span> nsw<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span>nsw <span style="color:#f92672">^&lt;&gt;</span> v<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CpSolver()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> status <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>Solve<span style="color:#f92672">(</span>model<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">match</span> status <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> CpSolverStatus.Optimal
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> CpSolverStatus.Feasible <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> vv x <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>Value<span style="color:#f92672">(</span>x<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> int
</span></span><span style="display:flex;"><span>    printfn <span style="color:#e6db74">&#34;wa = %i, nt = %i, sa = %i, q = %i, nsw = %i, v = %i, t = %i&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span>vv wa<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv nt<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv sa<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv q<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv nsw<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv v<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>vv t<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#f92672">_</span> <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    printfn <span style="color:#e6db74">&#34;no solution found&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// wa = 2, nt = 1, sa = 3, q = 2, nsw = 1, v = 2, t = 1
</span></span></span></code></pre></div><h2 id="stigler-diet">Stigler Diet<a hidden class="anchor" aria-hidden="true" href="#stigler-diet">#</a></h2>
<blockquote>
<p>The Stigler diet is an optimization problem named for George Stigler, a 1982 Nobel Laureate in economics, who posed the following problem:</p>
<blockquote>
<p>For a moderately active man weighing 154 pounds, how much of each of 77 foods should be eaten on a daily basis so that the man’s intake of nine nutrients will be at least equal to the recommended dietary allowances (RDAs) suggested by the National Research Council in 1943, with the cost of the diet being minimal?</p>
</blockquote>
</blockquote>
<p>(Taken from <a href="https://en.wikipedia.org/wiki/Stigler_diet">Wikipedia</a>).</p>
<p>It is also one of the <a href="https://developers.google.com/optimization/lp/stigler_diet">OR-Tools examples</a> for linear optimization. <a href="https://developers.google.com/optimization">OR-Tools</a> contains a full example in C#, but here the challenge was to turn it into <a href="https://fsharp.org">F#</a>.</p>
<h3 id="getting-the-data">Getting the data<a hidden class="anchor" aria-hidden="true" href="#getting-the-data">#</a></h3>
<p>I wanted to take the data directly from the web page to avoid any typing errors when copying the values. There are two tables of interests: one for the nutrients and one for the commodities. The get the data, the package <a href="">FSharp.Data</a> is used. It generates a dynamic type from the given URL and tables can be parsed row by row</p>
<p>The nutrient table looks like this:</p>
<table>
<thead>
<tr>
<th>Nutrient</th>
<th>Daily Recommended Intake</th>
</tr>
</thead>
<tbody>
<tr>
<td>Calories</td>
<td>3,000 calories</td>
</tr>
<tr>
<td>Protein</td>
<td>70 grams</td>
</tr>
</tbody>
</table>
<p>So we also have to extract the pure number from the second colum with the function <code>extractFloat</code>. In addition, calories and vitamin A have to be divided by 1000, since with commodities they are given as kilos.</p>
<p>The nutrients will give us the boundaries, and the commodities the coefficients. Each commodity corresponds to a variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">open</span> FSharp.Data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[&lt;</span>Literal<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> StiglerURL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://developers.google.com/optimization/lp/stigler_diet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StiglerData</span> <span style="color:#f92672">=</span> HtmlProvider<span style="color:#f92672">&lt;</span>StiglerURL<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> nutrientsTable <span style="color:#f92672">=</span> StiglerData.Load<span style="color:#f92672">(</span>StiglerURL<span style="color:#f92672">).</span>Tables<span style="color:#f92672">.</span>``Nutrients list``
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> commoditiesTable <span style="color:#f92672">=</span> StiglerData.Load<span style="color:#f92672">(</span>StiglerURL<span style="color:#f92672">).</span>Tables<span style="color:#f92672">.</span>``Commodities list``
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> extractFloat <span style="color:#f92672">(</span>s<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span><span style="color:#f92672">):</span> <span style="color:#66d9ef">float</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    Text.RegularExpressions.Regex.Replace<span style="color:#f92672">(</span>s<span style="color:#f92672">,</span> <span style="color:#e6db74">@&#34;[a-zA-Z &#39;,]&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> <span style="color:#66d9ef">float</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> nutrients <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    nutrientsTable<span style="color:#f92672">.</span>Rows
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Array.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> row <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> name <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>Nutrient
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> intake <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>``Daily Recommended Intake`` <span style="color:#f92672">|&gt;</span> extractFloat
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{|</span>
</span></span><span style="display:flex;"><span>            Name <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>Nutrient
</span></span><span style="display:flex;"><span>            Intake <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> name<span style="color:#f92672">.</span>Contains<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Calories&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> name<span style="color:#f92672">.</span>Contains<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Vitamin A&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">then</span> intake <span style="color:#f92672">/</span> 1000<span style="color:#f92672">.</span>0
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> intake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">|}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> commodities <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    commoditiesTable<span style="color:#f92672">.</span>Rows
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Array.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> row <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{|</span>
</span></span><span style="display:flex;"><span>            Name <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>Commodity
</span></span><span style="display:flex;"><span>            Price <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>``1939 price (cents)``
</span></span><span style="display:flex;"><span>            Unit <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>Unit
</span></span><span style="display:flex;"><span>            Nutrients <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">[|</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Calories (kcal)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Protein (g)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Calcium (g)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Iron (mg)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Vitamin A (KIU)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Thiamine (mg)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Riboflavin (mg)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Niacin (mg)``
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">float</span> row<span style="color:#f92672">.</span>``Ascorbic Acid (mg)``
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">|]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">|}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Now we can convert this to the usual arrays:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#75715e">// create the linear solver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> solver <span style="color:#f92672">=</span> Solver.CreateSolver<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;GLOP&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> <span style="color:#f92672">not</span> <span style="color:#f92672">(</span>isNull solver<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// create variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>commodities 
</span></span><span style="display:flex;"><span><span style="color:#f92672">|&gt;</span> Array.iter <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> commodity <span style="color:#f92672">-&gt;</span> 
</span></span><span style="display:flex;"><span>    solver<span style="color:#f92672">.</span>MakeNumVar<span style="color:#f92672">(</span>0<span style="color:#f92672">.</span>0<span style="color:#f92672">,</span> Double.PositiveInfinity<span style="color:#f92672">,</span> commodity<span style="color:#f92672">.</span>Name<span style="color:#f92672">)</span> <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> coefficients <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>    commodities
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> Array.map <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> com <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>        com<span style="color:#f92672">.</span>Nutrients
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|&gt;</span> array2D
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// constraints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>nutrients
</span></span><span style="display:flex;"><span><span style="color:#f92672">|&gt;</span> Array.iteri <span style="color:#f92672">(</span><span style="color:#66d9ef">fun</span> i nut <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> con <span style="color:#f92672">=</span> solver<span style="color:#f92672">.</span>MakeConstraint<span style="color:#f92672">(</span>nut<span style="color:#f92672">.</span>Intake<span style="color:#f92672">,</span> Double.PositiveInfinity<span style="color:#f92672">,</span> nut<span style="color:#f92672">.</span>Name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#66d9ef">in</span> 0<span style="color:#f92672">..</span>coefficients<span style="color:#f92672">.</span>GetLength<span style="color:#f92672">(</span>1<span style="color:#f92672">)-</span>1 <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        con<span style="color:#f92672">.</span>SetCoefficient<span style="color:#f92672">(</span>solver<span style="color:#f92672">.</span>variables()<span style="color:#f92672">.[</span>j<span style="color:#f92672">],</span> coefficients<span style="color:#f92672">.[</span>i<span style="color:#f92672">,</span> j<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><h3 id="optimization">Optimization<a hidden class="anchor" aria-hidden="true" href="#optimization">#</a></h3>
<h2 id="julia">Julia<a hidden class="anchor" aria-hidden="true" href="#julia">#</a></h2>
<p>TBD</p>
<h2 id="flips">Flips<a hidden class="anchor" aria-hidden="true" href="#flips">#</a></h2>
<blockquote>
<p><a href="https://github.com/fslaborg/flips">Flips</a> is an F# library for modeling and solving Linear Programming (LP) and Mixed-Integer Programming (MIP) problems. It is inspired by the work of the PuLP library for Python and the excellent Gurobi Python library. It builds on the work of the outstanding Google OR-Tools library and the OPTANO library.</p>
</blockquote>
<p>For me, it turned out that <a href="https://github.com/fslaborg/flips">Flips</a> is much more suited for <a href="https://fsharp.org">F#</a> programming of optimization problems that <a href="https://developers.google.com/optimization">OR-Tools</a>, which is not designed to be used with functional, strongly typed programming languages.</p>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li><a href="https://www.cs.toronto.edu/~stacho/public/IEOR4004-notes1.pdf">Prof. Juraj Stacho, Columbia University, New York: Introduction to Operations Research</a></li>
<li><a href="https://roughan.info/notes/oorii/03lecture_notes.html">Prof. Roughan: Optimisation and Operation Research</a></li>
<li><a href="https://developers.google.com/optimization">Google OR-Tools</a></li>
<li><a href="http://a-d-c.ca/solving-the-stigler-diet-problem-with-gurobi-cplex-and-glop/#page-content">Stigler Diet with Gurobi</a></li>
<li><a href="https://medium.com/geekculture/a-primer-on-the-operations-research-libraries-in-python-and-julia-d10da69591ff">Geek culture: A primer on the OR libraries in python and julia</a></li>
<li><a href="https://docs.mosek.com/modeling-cookbook/index.html">Mosek Modelling Cookbook</a></li>
<li><a href="https://towardsdatascience.com/supply-planning-using-linear-programming-with-python-bff2401bf270">Towards Data Science: Supply Planning</a></li>
</ul>
<h2 id="notes">Notes<a hidden class="anchor" aria-hidden="true" href="#notes">#</a></h2>
<p>Still looking for the best way to layout these equations with LaTeX.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>I took the liberty to change USD to EUR, since it doesn&rsquo;t conflict with the <code>$</code> sign used for mathematical Latex formatting.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/OR/">OR</a></li>
      <li><a href="http://localhost:1313/tags/OR-Tools/">OR-Tools</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Küse&#39;s Codes</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
